--============================ GROUP BY =====================================
--    GROUP BY cümleciði bir SELECT ifadesinde satýrlarý, sutunlarýn deðerlerine
--    göre özet olarak gruplamak için kullanýlýr.
--    GROUP BY cümleceði her grup baþýna bir satýr döndürür.
--    GROUP BY genelde, AVG(),COUNT(),MAX(),MIN() ve SUM() gibi aggregate
--   fonksiyonlarý ile birlikte kullanýlýr.


CREATE TABLE manav
    (
        isim varchar2(50),
        urun_adi varchar2(50),
        urun_miktari number(9)
    );
    INSERT INTO manav VALUES( 'Ali', 'Elma', 5);
    INSERT INTO manav VALUES( 'Ayse', 'Armut', 3);
    INSERT INTO manav VALUES( 'Veli', 'Elma', 2);
    INSERT INTO manav VALUES( 'Hasan', 'Uzum', 4);
    INSERT INTO manav VALUES( 'Ali', 'Armut', 2);
    INSERT INTO manav VALUES( 'Ayse', 'Elma', 3);
    INSERT INTO manav VALUES( 'Veli', 'Uzum', 4);
    INSERT INTO manav VALUES( 'Ali', 'Armut', 2);
    INSERT INTO manav VALUES( 'Veli', 'Elma', 3);
    INSERT INTO manav VALUES( 'Ayse', 'Uzum', 4);
    INSERT INTO manav VALUES( 'Ali', '', 2);
   
    select * from manav;
    
   --ORNEK1: kisi ismine göre satýlan toplam meyve miktarlarýný gösteren sorguyu
  --yazýnýz. ali=>5+2+2+2 sum= meyve sayýlarýný toplucak 
    
    select isim, SUM(urun_miktari) from manav
    GROUP By isim;
    
    --ORNEK2: satýlan meyve türüne (urun_adi) göre urun alan kiþi sayýsýný gösteren
  --sorguyu yazýnýz. NULL olarak girilen meyveyi listelemesin.count= elma alan kiþileri sayacak
   select urun_adi,COUNT(isim) kisi_sayisi from manav
   where urun_adi IS NOT NULL
   group by urun_adi;
   
   --ORNEK3: satýlan meyve türüne (URUN_ADÝ) göre satýlan (urun_miktari )MIN ve
  --MAX urun miktarlarini, MAX urun miktarina göre SIRALAYARAK listeyen sorguyu
  --yazýnýz
   select urun_adi, MIN(urun_miktari), MAX (urun_miktari) from manav
   group By urun_adi
   order by MAX(urun_miktari) desc;
  -- isme gore ama null suz yazdirirsak yazdirirsak
   select urun_adi, MIN(urun_miktari), MAX (urun_miktari) from manav
  where urun_adi IS NOT NULL
   group By urun_adi
   order by urun_adi desc;
  /* ************siralama asagidaki gibi olmali******
  1-- select from
  2-- where 
  3-- group by
  4-- having
  5-- order by
   */ 
    --ORNEK4: kisi ismine ve urun adýna (select) göre satýlan ürünlerin (sum)toplamýný
  --gruplandýran ve önce isme göre ters sira sonra urun_adi na göre ters sýrayla (order by) listeyen sorguyu yazýnýz.
  --önce isme göre sonra meyvelere=
    
  select isim, urun_adi, SUM(urun_miktari) from manav
  group by isim, urun_adi
  order by isim desc,urun_adi desc;
  
  /*ORNEK5: kisi ISMÝNE ve URUN ADINA göre, satýlan ürünlerin toplamýný bulan ve
   ** SELECT ISÝM, URUN_ADÝ    SUM(URUN_MÝKTARÝ) GROUP BY ISÝM, URUN_MÝKTARÝ**
  ve bu toplam deðeri 3 ve fazlasý olan kayýtlarý toplam urun miktarlarina göre
             **HAVÝNG SUM(URUN_MÝKTARÝ)>=3      **  ORDER BY SUM(URUN_MÝKTARÝ)
  ters siralayarak listeyen sorguyu yazýnýz.  veli elma 5
       **DESC                                 ali elma 5
                                              ali armut 4...*/
  
  select isim, urun_adi, SUM(urun_miktari) from manav
  group by isim, urun_adi
  HAVING sum(urun_miktari)>=3
  order by sum(urun_miktari) desc;
  
 /*ORNEK6: satýlan urun_adi'na göre gruplayýp MAX urun sayýlarýný,(yine max ürün sayýsýna göre)
  sýralayarak listeyen sorguyu yazýnýz. NOT: Sorgu, sadece MAKS urun_miktari
  MIN urun_miktarýna eþit olmayan kayýtlarý (where gibi koþul var) listelemelidir.
 */ 
  select urun_adi, MAX(urun_miktari) from manav
  group by urun_adi
  HAVING max(urun_miktari)<>MIN(urun_miktari)
  order by MAX(urun_miktari);
  /*=============================================== 
  DISTINCT cümleciði bir SORGU ifadesinde benzer olan satýrlarý flitrelemek
    için kullanýlýr. Dolayýsýyla seçilen sutun yada sutunlar için benzersiz veri
    içeren satýrlar oluþturmaya yarar.
    SYNTAX
    -------
    SELECT DISTINCT sutun_adi1, sutun_adi2, satin_adi3
    FROM  tablo_adý;
    
  */
  --ORNEK1: satýlan farklý meyve türlerinin sayýsýný listeyen sorguyu yazýnýz.
  --(kaç farklý meyve türü var, elma armut üzüm=3)
  
  select COUNT (DISTINCT urun_adi) urun_cesit_sayisi from manav;
  
  --ORNEK2: satýlan meyve ve isimlerin (totalde )farklý olanlarýný listeyen sorguyu yazýnýz.
  
  select DISTINCT urun_adi,isim from manav;
--ORNEK3: satýlan meyvelerin urun_mikarlarinin benzersiz  olanlarýnýn
  --toplamlarini listeyen sorguyu yazýnýz.2+3+4+5=14
  
  select SUM(DISTINCT urun_miktari) benzersiz_urun_sayisi_toplami from manav;